# MDebook チュートリアル

このチュートリアルでは、ブラウザベースのMarkdown電子書籍エディタ「MDebook」の基本的な使い方を説明します。

**バージョン: 0.4.5**

**👉 [MDebookを起動](https://fukuyori.github.io/mdebook/dist/mdebook.html)**

## 目次

1. [はじめに](#はじめに)
2. [エディタの基本](#エディタの基本)
3. [VIMモード](#vimモード)
4. [ファイル管理](#ファイル管理)
5. [画像の操作](#画像の操作)
6. [書籍構成テンプレート](#書籍構成テンプレート)
7. [EPUBテーマ](#epubテーマ)
8. [PDFエクスポート](#pdfエクスポート)
9. [インポート・エクスポート](#インポートエクスポート)
10. [プロジェクト管理](#プロジェクト管理)
11. [便利な使い方](#便利な使い方)

---

## はじめに

### MDebookを開く

**オンライン（推奨）：**
- [https://fukuyori.github.io/mdebook/dist/mdebook.html](https://fukuyori.github.io/mdebook/dist/mdebook.html) にアクセス

**オフライン：**
1. リリースページから`mdebook.html`をダウンロード
2. ブラウザでファイルを開く（Chrome、Edge、Firefox推奨）

サンプルドキュメントが表示された状態でエディタが起動します。

### インターフェース概要

```
┌─────────────────────────────────────────────────────────────┐
│  MDebook v0.4.5  [ツールバーアイコン]            [言語 ▼]   │
├─────────┬───────────────────────┬───────────────────────────┤
│         │                       │                           │
│ ファイル │      エディタ         │      プレビュー            │
│  タブ   │                       │                           │
│         │                       │                           │
├─────────┴───────────────────────┴───────────────────────────┤
│  [VIMモード: NORMAL]          [行:列]           [行数]       │
├─────────────────────────────────────────────────────────────┤
│  [ファイル数: N]  [文字数: N]                    [ステータス] │
└─────────────────────────────────────────────────────────────┘
```

---

## エディタの基本

### Markdownの記述

MDebookは標準Markdownと拡張機能をサポートしています：

```markdown
# 見出し1
## 見出し2

**太字** と *斜体* テキスト

- 箇条書き
- 別の項目

1. 番号付きリスト
2. 2番目の項目

> 引用

`インラインコード`

​```javascript
// シンタックスハイライト付きコードブロック
function hello() {
  console.log("こんにちは！");
}
​```

| 列1 | 列2 |
|-----|-----|
| データ1 | データ2 |

[リンク](https://example.com)

![画像](images/photo.png)

脚注参照[^1]

[^1]: 脚注の内容
```

### Mermaidダイアグラム

Mermaid記法で図を作成：

```markdown
​```mermaid
graph LR
    A[開始] --> B[処理]
    B --> C[終了]
​```
```

### 補足欄（アドモニション）

```markdown
:::note
これは注釈です。
:::

:::warning 警告タイトル
これは警告メッセージです。
:::

:::tip
これは便利なヒントです！
:::
```

対応タイプ: `note`, `warning`, `tip`, `info`, `caution`, `important`

### ライブプレビュー

- 入力に合わせてプレビューがリアルタイム更新
- スクロール同期：エディタのスクロールがプレビューと連動（逆も同様）
- ツールバーの目のアイコンでプレビュー表示を切り替え

---

## VIMモード

MDebookは効率的な編集のためのフルVIMキーバインドを搭載しています。

### モードインジケーター

ステータスバーに現在のVIMモードが表示されます：
- **NORMAL**（青）- ナビゲーションとコマンド
- **INSERT**（緑）- テキスト入力
- **VISUAL**（紫）- テキスト選択
- **REPLACE**（赤）- 上書きモード

### 基本ナビゲーション（NORMALモード）

| キー | 動作 |
|-----|------|
| `h` | 左に移動 |
| `j` | 下に移動 |
| `k` | 上に移動 |
| `l` | 右に移動 |
| `w` | 次の単語 |
| `b` | 前の単語 |
| `0` | 行頭 |
| `$` | 行末 |
| `gg` | ファイル先頭 |
| `G` | ファイル末尾 |

### INSERTモードへの移行

| キー | 動作 |
|-----|------|
| `i` | カーソル前に挿入 |
| `a` | カーソル後に挿入 |
| `I` | 行頭に挿入 |
| `A` | 行末に挿入 |
| `o` | 下に新しい行 |
| `O` | 上に新しい行 |

### 編集コマンド

| キー | 動作 |
|-----|------|
| `dd` | 行を削除 |
| `yy` | 行をヤンク（コピー） |
| `p` | カーソル後にペースト |
| `P` | カーソル前にペースト |
| `u` | 元に戻す |
| `Ctrl+r` | やり直し |
| `x` | 文字を削除 |
| `r` | 文字を置換 |

### Exコマンド

| コマンド | 動作 |
|---------|------|
| `:w` | 保存（上書き） |
| `:w!` | ダイアログで保存 |
| `:w ファイル名` | 名前を付けて保存 |
| `:e ファイル名` | ファイルを開く/作成 |
| `:q` | ファイルを閉じる |
| `:wq` | 保存して閉じる |
| `:imp` | インポートダイアログ |
| `:imp URL` | URLからインポート |

### VIMモードを無効にする

- ツールバーの**VIM**ボタンをクリック
- または`Ctrl+\``でトグル

---

## ファイル管理

### 新規ファイルの作成

1. ファイルタブの下部にある**+**ボタンをクリック
2. またはVIMコマンドモードで`:e newfile.md`

### ファイル名の変更

1. ファイルタブをダブルクリック
2. 新しい名前を入力
3. Enterで確定（Escapeでキャンセル）

### ファイルの並び替え

- ファイルタブをドラッグ&ドロップで並び替え
- エクスポート時にこの順序が維持されます

### ファイルの削除

- ファイルタブの**×**ボタンをクリック
- 注意：最後の1つのファイルは削除できません

### ファイルのインポート

**ローカルファイルから：**
1. ツールバーのフォルダアイコンをクリック
2. または`.md`ファイルをアプリにドラッグ&ドロップ
3. 現在アクティブなタブの後に挿入されます

**URLから：**
1. `:imp URL`を使用するかフォルダアイコンをクリック
2. 対応URL：
   - Qiita記事（`.md`が自動追加）
   - GitHubファイル（rawに自動変換）
   - 直接の`.md` URL

---

## 画像の操作

### 画像の追加

**方法1：クリップボードからペースト**
1. 画像をクリップボードにコピー
2. エディタでペースト（`Ctrl+V`）
3. 画像が埋め込まれ、Markdown参照が挿入される

**方法2：ドラッグ&ドロップ**
1. 画像ファイルをエディタエリアにドラッグ
2. 画像がプロジェクトに追加される

**方法3：ファイルピッカー**
1. ツールバーの画像アイコンをクリック
2. 画像ファイルを選択

### 画像の保存

- 画像はプロジェクト内に保存されます
- `![alt](images/image-id)`として参照
- `.mdebook`として保存時に自動的に含まれる
- 参照されていない画像は手動保存時にクリーンアップ

---

## 書籍構成テンプレート

MDebookは一般的な書籍要素のテンプレートを提供しています。

### テンプレートの追加

1. ツールバーの**「+ テンプレート」**ボタンをクリック
2. 利用可能なテンプレートから選択：
   - 📋 奥付
   - 📖 はじめに
   - 📑 章扉
   - 📚 参考文献

### テンプレートの種類

| テンプレート | 説明 | 自動配置 |
|------------|------|---------|
| **奥付** | 出版情報（タイトル、著者、日付、著作権） | 本の末尾 |
| **はじめに** | 序文/まえがき | 本の先頭 |
| **章扉** | エピグラフ付きの装飾的な章開始ページ | 現在のタブの後 |
| **参考文献** | 参考文献リスト | 奥付の前 |

### 章扉のフォーマット

```markdown
<div class="chapter-title-page">

# 第1章

## 章タイトルをここに入力

> "引用文（任意）"
> — 著者名

</div>

---

<!-- 本文をここから書き始めてください -->
```

**目次での表示：**
- EPUB/PDFの目次: 「第1章 章タイトルをここに入力」（結合表示）
- ページ上では章番号とサブタイトルが別々に表示

---

## EPUBテーマ

### プリセットテーマ

| テーマ | 説明 | 用途 |
|--------|------|------|
| **クラシック** | 控えめな罫線の伝統的セリフ体 | 文学、一般書籍 |
| **モダン** | 青いアクセントのサンセリフ体 | ビジネス書 |
| **テクニカル** | ダークレッド見出しのオライリー風 | 技術ドキュメント |
| **小説** | シーン区切り対応の読書最適化 | フィクション |
| **アカデミック** | 両端揃えの学術スタイル | 学術論文 |

### テーマの選択

1. 歯車アイコンをクリックして設定を開く
2. **テーマ**ドロップダウンを探す
3. 好みのテーマを選択
4. EPUBエクスポート時にテーマが適用される

### カスタムCSSの使用

**テーマのエクスポート（開始点として）：**
1. ドロップダウンからテーマを選択
2. **↓ CSS**ボタンをクリック
3. CSSファイルがダウンロードされる

**カスタムCSSのインポート：**
1. CSSファイルを編集
2. **↑ CSS**ボタンをクリック
3. CSSファイルを選択
4. テーマが自動的に「カスタム」に切り替わる
5. 「カスタム ✓」はカスタムCSSが読み込まれていることを示す

### Kindle最適化CSS

すべてのプリセットテーマはKindleパブリッシングガイドライン2025に準拠：

```css
html { font-size: 100%; }
body {
  margin: 0;
  padding: 0;
  line-height: 1.7;
  text-align: justify;
  word-wrap: break-word;
}

h1 { font-size: 1.6em; page-break-before: always; }
h2 { font-size: 1.3em; }
h3 { font-size: 1.1em; }

code { font-size: 0.9em; }
pre { font-size: 0.9em; }
pre code { font-size: inherit; }
```

---

## PDFエクスポート

MDebook v0.4.5ではpdfmakeによるネイティブPDF生成機能を搭載しています。

### 日本語フォントの設定

1. [Google Fonts - Noto Sans JP](https://fonts.google.com/noto/specimen/Noto+Sans+JP) からフォントをダウンロード
2. 設定（歯車アイコン）を開く
3. **「PDF用フォント設定」**までスクロール
4. 標準フォント（必須）と太字フォント（任意）をアップロード
5. フォントはIndexedDBに保存（セッション間で永続化）

### PDF機能

| 機能 | 対応 |
|------|------|
| 見出し（h1-h4） | ✅ 目次リンク付きスタイル |
| テーブル | ✅ 罫線とヘッダースタイル |
| コードブロック | ✅ 等幅フォント、背景色 |
| リスト（ul/ol） | ✅ ネスト対応 |
| リンク | ✅ クリック可能、下線付き |
| 太字/イタリック | ✅ インライン書式 |
| 引用 | ✅ インデント付きスタイル、改行保持 |
| 水平線 | ✅ グレーライン |
| 章扉 | ✅ 結合目次エントリ |
| 奥付 | ✅ 目次から除外 |
| 絵文字 | ⚠️ 自動削除（フォント制限） |
| 画像 | ❌ 未対応 |
| Mermaid | ❌ 未対応 |

### 目次深度設定

EPUBとPDF両方の目次深度を制御：
- **0**: 目次なし
- **1**: H1のみ
- **2**: H1 + H2（デフォルト）
- **3**: H1 + H2 + H3

### PDFでのテーマCSS

PDFエクスポートはEPUBテーマ設定を反映：
- 行間
- 文字間隔
- テキスト配置
- 見出しの色とサイズ

---

## インポート・エクスポート

### エクスポート形式

**EPUB**
- 標準的な電子書籍形式
- Kindle、Apple Booksなどと互換性あり
- 表紙画像をサポート（設定パネルで設定）
- 選択したテーマを適用
- MermaidダイアグラムはPNGに変換
- エクスポート → EPUB をクリック

**PDF**
- pdfmakeによるネイティブPDF
- 日本語フォント対応（設定でアップロード）
- リンク付き自動生成目次
- ヘッダーにタイトル、フッターにページ番号
- エクスポート → PDF をクリック

**HTML**
- スタイル埋め込みのスタンドアロンHTMLファイル
- ダーク/ライトテーマ設定を維持
- エクスポート → HTML をクリック

**Markdown (ZIP)**
- すべての章と画像をエクスポート
- 構造：
  ```
  book-markdown.zip
  ├── metadata.json
  ├── chapters/
  │   ├── chapter1.md
  │   └── chapter2.md
  └── images/
      └── image.png
  ```
- エクスポート → Markdown (ZIP) をクリック

### プロジェクトのインポート

**`.mdebook`ファイルから：**
1. 開く（フォルダアイコン）をクリック
2. `.mdebook`ファイルを選択
3. またはアプリにドラッグ&ドロップ

**Markdownファイルから：**
1. インポートダイアログを使用
2. または`.md`ファイルをドラッグ&ドロップ

---

## プロジェクト管理

### プロジェクトの保存

**クイック保存（`:w`）**
- File System Access APIで開いた場合は現在のファイルを上書き
- そうでなければ保存ダイアログを開く

**ダイアログで保存（`:w!`）**
- 常に保存ダイアログを開く

**プロジェクト形式**
- `.mdebook`ファイルには以下が含まれます：
  - すべての章（.md拡張子付きMarkdown）
  - 埋め込み画像
  - メタデータ（タイトル、著者、言語）
  - UI設定

### 自動保存

- セッションはIndexedDBに自動保存
- ブラウザを再度開くと復元
- 各ブラウザタブは独自のセッションを持つ

### 設定パネル

歯車アイコンをクリックしてアクセス：
- **タイトル**：本のタイトル（エクスポートで使用）
- **著者**：著者名
- **言語**：本の言語（EPUBメタデータ用）
- **表紙画像**：プロジェクト内の画像から選択（EPUB用）
- **テーマ**：EPUBテーマの選択またはカスタムCSSの使用
- **目次深度**：目次の深度（0-3）
- **PDF用フォント設定**：日本語フォントのアップロード

---

## 便利な使い方

### キーボードショートカット

| ショートカット | 動作 |
|---------------|------|
| `Ctrl+\`` | VIMモードの切り替え |
| `Esc` | NORMALモードに戻る / ダイアログを閉じる |

### URLインポートのヒント

```
# Qiita記事
https://qiita.com/username/items/article-id

# GitHubファイル
https://github.com/user/repo/blob/main/file.md

# Raw URL
https://example.com/document.md
```

### 効率的なワークフロー

1. **アウトラインから始める**：章ごとに複数のファイルを作成
2. **テンプレートを活用**：章扉を追加してプロフェッショナルな仕上がりに
3. **自由に並び替え**：タブをドラッグして構造を整理
4. **VIMを使う**：`:w`と`:e`をマスターして素早くファイル操作
5. **頻繁にプレビュー**：プレビューを切り替えてフォーマットを確認
6. **テーマを早めに選ぶ**：執筆前に適切なEPUBテーマを選択
7. **早めにエクスポート**：問題を早期発見するためにEPUB/PDFエクスポートをテスト

### ベストプラクティス

- 説明的なファイル名を使用（エクスポートで章タイトルになります）
- 電子書籍互換性のために画像サイズを適度に保つ
- `:w`で定期的に保存
- 画像を含むプロジェクトには`.mdebook`形式を使用
- テーマをカスタマイズするにはCSSをエクスポート
- PDFエクスポート前に日本語フォントをアップロード

---

## トラブルシューティング

### プレビューが更新されない

- プレビューが表示されているか確認（目のアイコン）
- VIMモードをオフにしてから再度オンにしてみる

### 画像が表示されない

- 画像がプロジェクト内にあることを確認（外部URLではなく）
- 画像パスの形式を確認：`![alt](images/id)`

### 保存が機能しない

- Chrome/Edge：File System Access APIで動作するはず
- Firefox/Safari：常にダウンロードダイアログが表示されます

### VIMモードの問題

- NORMALモードであることを確認するために`Esc`を複数回押す
- ステータスバーのモードインジケーターを確認

### テーマが適用されない

- テーマはEPUB/PDFエクスポートにのみ適用され、プレビューには反映されません
- 設定でテーマが選択されていることを確認
- カスタムCSSの場合、ファイルが読み込まれていることを確認（「カスタム ✓」と表示）

### PDFエクスポートの問題

- **日本語が表示されない**：設定 → PDF用フォント設定でフォントをアップロード
- **フォントが保存されない**：IndexedDBのサポートが良いChromeを使用
- **絵文字が□で表示**：絵文字はPDFでは自動削除されます

### IndexedDBの問題

- `file://`プロトコルでは一部のブラウザでIndexedDBが制限される場合があります
- 最良の結果を得るにはChromeを使用するかローカルサーバーを起動

---

## ヘルプ

- [GitHub Issues](https://github.com/fukuyori/mdebook/issues)
- [README](../README.ja.md)

---

楽しい執筆を！📚
